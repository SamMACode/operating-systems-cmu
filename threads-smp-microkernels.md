# 线程、对称多处理（SMP）和微内核

> 一些与进程管理相关的更高级的概念：一个与资源所有权相关，一个与执行相关。在许多操作系统中出现并发展了称为线程的结构。在分析线程之后，接下来是对称多处理（SMP）情况下，操作系统必须能够同时在多个处理器上调度不同的进程。最后为微内核概念，它是构造操作系统以支持进程管理及相关任务的一种有效方法。

## 1. 进程与线程

到目前为止提出的进程的概念包括两个特点，很多操作系统能够独立的处理。为了区分，分派的单位通常称做线程或轻量级进程，而拥有资源所有权的单位通常仍称做进程或任务：

1. **资源所有权**：一个进程包括一个存放进程映像的虚拟地址空间，进程映像是程序、数据、栈和进程控制块中定义的属性的集合。一个进程总是拥有对资源的控制或所有权，这些资源包括内存、I/O通道、I/O设备和文件。操作系统执行保护功能，以防止进程之间发生不必要的与资源相关的冲突。
2. **调度/执行**：一个进程沿着一个或者多个程序的一条路径执行，其执行过程可能与其它进程的执行过程交替进行（cpu时间片用完、IO阻塞等）。因此，一个进程具有一个执行状态（运行、就绪等）和一个分配的优先级，并且是一个可被操作系统调度和分派的实体。

<img src="./reference-media/process-vs-threads.png" alt="process-vs-threads" style="zoom:45%;" />

多线程是指操作系统在单个进程内支持多个并发执行路径，每个进程中只有一个线程在执行的传统方法称为单线程方法。在一个进程中可能有一个或多个线程，每个线程具有：线程执行状态（运行、就绪等）、在未运行时保存的线程上下文、执行栈、用于每个线程局部变量的静态存储空间、与进程内的其他线程共享对进程的内存和资源的访问。

进程与线程的区别：在单线程进程模型中，进程包括它的进程控制块和用户地址空间，以及在进程执行中管理调用/返回行为的用户栈和内核栈。进程中每个线程都有一个独立的栈，还有独立的控制块用于包含寄存器值、优先级和其他线程相关的状态。进程中的所有线程共享该进程的状态和资源，它们驻留在同一块地址空间中，并且可以访问相同的数据。

**从性能分析线程的优点**：1）在进程中创建一个新线程要比新进程花费更少时间，同时终止也更轻量级操作。2）同一进程内线程间切换要比进程间切换容易。3）在线程间的通信效率更高，由于共享相同进程控制块和用户地址空间。而进程间的通信则需要依赖于操作系统内核。

**用户级和内核级线程**：