# 内存管理

> 在单道程序设计系统中，内存被划分成两部分：一部分供操作系统使用（驻留监控程序、内核），一部分供当前正在执行的程序使用。在多道程序设计系统中，必须在内存中进一步细分出“用户”部分，以满足多个进程的要求。细分的任务由操作系统动态完成，这称为内存管理。

内存管理相关术语：

| 页框 | 内存中一个固定长度的块                                       |
| ---- | :----------------------------------------------------------- |
| 页   | 一个固定长度的数据块，存储在二级存储器中（如磁盘），数据页可以临时复制入内存中的页框中 |
| 段   | 一个变长的数据块，存储在二级存储器中。整个段可以临时复制到内存的一个可用区域内（分段），或者可以将一个段分为许多页，将每页单独复制到内存中（分段与分页相结合） |

## 1. 内存管理的需求

当研究与内存管理相关的各种机制和策略时，清楚内存管理要满足的要求是非常有用的。`[LIST93]`对内存管理提出了`5`点需求：重定位、保护、共享、逻辑组织、物理组织。

1. **重定位**：在多道程序设计系统中，可用的内存空间通常被多个进程共享。通常情况下，程序员并不能事先知道在某个程序执行期间会有其他哪些程序驻留在内存中。当程序被换出到磁盘，在下一次进程被重新换入内存时，需要重新定位数据的起始位置。执行程序时，处理器硬件和操作系统软件必须能够通过某种方式把程序代码中的内存访问换成实际的物理内存地址，并反映程序在内存中的当前位置。
2. **保护**：每个进程都应该受到保护，以免被其他进程有意或无意得干涉。由于程序在内存中的位置是不可预测的，因而在编译时不可能检查绝对地址来确保保护。并且大多数程序语言允许在运行时进程地址的动态计算（例如，通过计算数组下标或者数据结构中的指针）。用户进程不能访问操作系统的任何部分，不论程序还是数据。内存保护的需求必须由处理器（硬件）来满足。
3. **共享**：任何保护机制都必须具有一定的灵活性，以允许多个进程访问内存的同一部分。合作完成同一个任务的进程可能需要共享访问相同的数据结构。
4. **逻辑组织**：计算机系统中的内存总是被组织成线性的（或者一维的）地址空间，并且地址空间是由一系列字节或字组成的。外部存储器在物理层上也是按类似方式组织的。可以独立得编写和编译模块，系统在运行时解析从一个模块到另一个模块的所有引用。通过适度的额外开销，可以引入某种机制，使得模块可以被多个线程共享。
5. **物理组织**：计算机存储器至少要被组织成两级，称为内存和外存。内存提供快速的访问，成本也相对比较高。并且内存是易失的。外存比内存更便宜，它通常是非易失性的。在这种两级方案中，系统主要关注的是内存和外存之间信息流的组织。

## 2. 内存分区

内存管理最基本的操作是由处理器把程序装入内存中执行。在大部分现代多道程序设计系统中，这往往还涉及一种称之为虚拟内存的精密方案。虚拟内存又基于分段和分页这两种基本技术或其中的一种。在考虑虚拟内存技术前，先考虑一些不涉及虚拟内存的简单技术：固定分区、动态分区、伙伴系统和重定位技术。

**固定分区**：固定分区的两种选择，