# 多处理器和实时调度

> 当一个计算机系统包含多个处理器时，在设计调度功能时就会产生一些新问题。多处理器系统功能可以划分为：1）松耦合、分布式多处理器、集群，由一系列相对自治的系统组成，每个处理器都有自己的内存和`I/O`通道；2）专门功能处理器，`I/O`处理器就是一个典型的例子；3）紧耦合多处理：由一系列共享同一个内存并在操作系统完全控制下的处理器组成；

多处理器中调度涉及三个相互关联的问题：

* 把进程分配到处理器；
* 在单个处理器上使用多道程序设计；
* 一个进程的实际分派；

静态分配的缺点是一个处理器可能处于空闲状体啊，这时它的队列为空，而另一个处理器却积压了许多工作。为了防止这种情况的发生，需要使用一个公共队列。所有进程都进入一个全局队列，然后调度到任何一个可用的处理器中。这样，在一个进程的生命周期中，它可以在不同的时间在不同的处理器上执行。

**线程调度**：线程执行的概念与进程中的定义是不同的，一个应用程序可以作为一组线程来实现。这些线程都可以在同一个地址空间中协作和并发地执行。在多处理器线程调度和处理器分配的各种方案中，有`4`种比较突出的方法：

* 负载共享，进程不是分配到一个特定的处理器。系统维护一个就绪进程的全局队列，每个处理器只要空闲就从队列中选择一个线程。这里使用术语"负载共享"来区分这种策略和负载平衡（`load balance`）方案，负载平衡是一种比较永久的分配方案分配工作的。
* 组调度，一组相关的线程基于一对一的原则，同时调度到一组处理器上运行。
* 专用处理器分配，这种方法正好与负载分配的方法相反，它通过把线程指定到处理器上来定义隐式的调度。
* 动态创建，在执行期间，进程中线程的数目可以改变。

实时操作系统可以被描述成具备以下`5`个方面的要求：可确定性、可响应性、用户控制、可靠性、故障弱化性。**故障弱化操作**（`fail-soft operation`）指系统在故障时尽可能多地保存其性能和数据的能力。



## Q&A 复习题

1. 简要描述三种类型的处理器调度。

   答：长程调度，决定添加到要执行的进程池中；中程调度，决定增加部分或全部位于主内存中进程数量的决定；短程调度，决定处理器将执行哪个可用进程。

2. 在交互式操作系统中，通常最重要的性能要求是什么？

   答：响应时间。

3. 周转时间和响应时间有什么区别？

   答：周转时间是请求在系统中花费的总时间（等待时间`+`服务时间）。响应时间是从提交请求到响应开始显示为输出之间的经过时间。

4. 对于进程调度，较小的优先级值表示较低的优先级还是较高的优先级？

   答：在`unix`和许多其它系统中，较大的优先级表示较低优先级的进程。某些系统（例如`windows`）使用相反的约定，数字越大优先级越高。

5. 抢占式和非抢占式调度有什么区别？

   答：非抢占式，如果进程处于运行状态，它将继续执行，直到`(a)`终止或`(b)`阻塞自身以等待`I/O`请求或请求某些操作系统服务。抢占式，操作系统可能会中断当前正在运行的进程并将其移至"就绪"状态。抢占的决定可以在新进程到达时、发生中断时将阻塞进程置于"就绪"状态，也可以基于时钟中断执行。

6. 简单定义`FCFS`调度。

   答：每个进程准备就绪后，它将加入就绪队列中。当当前正在运行的进程停止执行时，已进入就绪队列中时间最长的进程将被选择运行。

7. 简单定义轮转调度。

   答：时钟中断会定期产生，发生中断时，当前正在运行的进程将置于就绪队列中，并根据`FCFS`选择下一个就绪作业。

8. 简单定义最短进程优先调度。

   答：这是一种非抢占式策略，其中接下来选择预期处理时间最短的进程。

9. 简单定义最短剩余时间调度。

   答：这是`SPN`的抢占版本，在这种情况下，调度程序始终选择预期剩余处理时间最短的进程。当新进程加入就绪队列时，实际上其剩余时间可能比当前正在运行的进程短。因此，只要新进程准备就绪，调度程序就可以抢占。

10. 简单定义最高响应比优先调度。

    答：当前进程完成或被阻塞时，请选择具有`R`最大值的进程，其中`R=(w+s)/s`，其中`w`=处理器花费的时间，`s`=预期服务的时间。

11. 简单定义反馈调度。

    答：调度是基于抢占式（在时间范围内）进程的，在使用了动态优先级机制。进程首次进入系统时，将器放置在`RQ0`。第一次执行后，当它返回就绪状态时，它将被放置在`RQ1`中。以后每次被抢占时，它将降级到下一个较低优先级的队列。较短的进程将很快完成，而无需在就绪队列中层次结构中进行很远的迁移。一个较长的进程将逐渐向下漂移，因此，新的、较短的进程比旧的、较长的进程更受青睐。在每个队列中，除最低优先级队列外，都使用简单的`FCFS`机制。一旦进入最低优先级队列，进程就不能再降低，而是反复返回到此队列，直到完成执行为止。

## Part-02 复习题

1. 列出并简单定义五种不同级别的同步粒度。

   答：很好，单个指令流中固有并行性；中，单个应用程序中的并行处理或多任务处理；粗略，在多编程环境中对并发对并发进程进行多处理。非常粗糙，跨网络节点的分布式处理以形成单个计算环境。独立，多个不相关的进程。

2. 列出简单定义线程调度的四种技术。

   答：负载共享，进程未分配任何特定的处理器。维护就绪线程的全局队列，并且每个处理器在空闲时都从队列中选择一个线程。术语负载共享用于将这种策略于负载均衡方案区分开，在负载均衡方案中，工作是在更永久的基础上分配的；`Gang`调度，一组相关线程被调度为在一对一的基础上同时在一组处理器上运行；专用处理器分配，在程序执行期间，为每个进程分配的处理器数量等于进程中的线程数量。当进程中止时，处理器将返回通用池，以可能分配给另一个程序；动态调度，在执行过程中可以更改程序中的线程数。

3. 列出并简单定义三种版本的负载分配。

   答：先到先服务(`FCFS`)，作业到达时，其每个线程都连续放置到共享队列的末尾。当处理器空闲时，它将选择下一个就绪线程，该线程将执行完成或阻塞为止；最少的线程数：共享就绪队列被组织为优先级队列，其中优先级最高的是未计划线程数量少的作业中的线程。优先级相同的作业将根据先到达的作业进行排序，与`FCFS`一样，计划线程将运行到完成或阻塞；先占式最少的线程数，优先级最高的是未计划线程数最少的作业。具有比正在执行的作业更少的线程数的到达作业将抢占属于计划作业的线程。

4. 硬实时任务和软实时任务有什么区别？

   答：硬实时任务是必须按时完成的任务，否则会导致系统损坏或致命错误。软实时任务具有一个相关的截止时间，该截止时间是理想的，但不是强制的。即使已经过了期限，安排和完成任务仍然有意义。

5. 周期性实时任务和非周期性实时任务有什么区别？

   答：非周期性任务有一个必须完成或开始截止日期，或者可能对开始和结束时间都有限制。在定期任务的情况下，该要求可以表示为"每周期T一次"或"相距精确T个单位"。

6. 列出并简单定义对实时操作系统的五方面的要求。

   答：确定性，操作系统具有一定的确定性，即它以固定的预定时间或在预定时间间隔内执行操作；响应度，响应度与确认后操作系统花多长时间来处理中断有关；用户控制，用户应该能够区分硬任务和软任务，并可以在每个类别中指定相对优先级。实时系统还可以允许用户指定以下特性，例如使用分页或进程交换，必须始终将哪些进程驻留在主内存中，要使用哪些磁盘传输算法，在各个优先级带中对进程具有什么权限有，等等；可靠性，必须以持续满足实时期限的方式提供可靠性；软故障操作，软故障操作是一种特性，指的是系统以保持尽可能多的功能和数据的方式发生故障的能力。

7. 列出并简单定义四类实时调度算法。

   答：静态表驱动方法：这些方法对可行的调度时间表执行静态分析。分析的结果是一个计划，该计划在运行时确定何时必须开始执行任务。静态优先级驱动的抢占式方法：再次执行静态分析，但未制定计划。相反，该分析用于为任务分配优先级，以便可以使用传统的优先级驱动的抢占式调度程序。基于动态计划的方法：可行性是在运行时（动态）确定的，而不是在开始执行之前（静态）离线的。仅在可行的情况下满足其时间限制，才接受执行的任务。可行性分析的结果之一是进度表或计划，用于决定何时分派此任务。动态尽力而为方法：不执行可行性分析。系统尝试满足所有期限，并中止错过期限的任何已启动过程。

8. 关于一个任务的哪些信息在实时调度时候非常有用？

   答：准备时间：准备执行任务的时间。在重复性或周期性任务的情况下，这实际上是预先知道的时间序列。在非定期任务的情况下，此时间可能提前知道，或者操作系统可能只知道任务实际准备就绪的时间。开始截止时间：必须开始任务的时间。完成期限：必须完成任务的时间。典型的实时应用程序将具有开始期限或完成期限，但不能同时具有两者。处理时间：完成任务所需的时间。在某些情况下，这是提供的。在其他操作系统中，操作系统测量指数平均值。对于其他调度系统，不使用此信息。资源要求：任务在执行时需要的资源集（处理器除外）。优先级：衡量任务的相对重要性。硬实时任务可能具有“绝对”优先级，如果错过最后期限，系统就会失败。如果无论如何系统都将继续运行，则可以为硬实时和软实时任务分配相对优先级，以作为调度程序的指南。子任务结构：任务可以分解为强制子任务和可选子任务。只有强制性子任务具有硬性期限。